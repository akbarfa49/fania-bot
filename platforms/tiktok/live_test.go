package tiktok

import (
	"context"
	"fmt"
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestLive(t *testing.T) {
	client := New("msToken=WSwc1ENaJmrffkTfSm09F__4hdePKT1kEIkYzPA3IAIzaaVv6V_KKyl0tNJKCExaPRULiXXocgfWwJr-c7doKfozK1yrHQhzxMVZeoeFjH013FZRHJgGGjDLtB5ObRBAzbm3;ttwid=1%7CvyvSBKp0epZPfN3pzTALtKK6eoTIHop5lAEj9_in3ZM%7C1710836783%7C9d9873a03fb76b3c1a13312141a3c301325e9352a037cfa760c90a6b678eb0b0; odin_tt=443152ba5897e5aa7b1982b1b00210806de187446fefc90b01935fa75824c3f04b65dda25bbf6e9bd0049d2c1170e0d520ba0371b781265377b78dcb30c2d1f95469984397859517307ff780c8342075; passport_csrf_token=580970023ed8167583e9829060d7862c; passport_csrf_token_default=580970023ed8167583e9829060d7862c; multi_sids=7333649568419595269%3Ac5f46214aa10bb62741ceb676dca3a2c; cmpl_token=AgQQAPOgF-RO0rX4tcrQ6h08_7c2QZjFP4MrYNEaGQ; passport_auth_status=ca184842c78004a6b2a2b5f765c48fa5%2C; passport_auth_status_ss=ca184842c78004a6b2a2b5f765c48fa5%2C; sid_guard=c5f46214aa10bb62741ceb676dca3a2c%7C1708568494%7C15552000%7CTue%2C+20-Aug-2024+02%3A21%3A34+GMT; uid_tt=c053b569cc890102fd4c6cf145842f8b032cf61addec6166a5bb03122c302caf; uid_tt_ss=c053b569cc890102fd4c6cf145842f8b032cf61addec6166a5bb03122c302caf; sid_tt=c5f46214aa10bb62741ceb676dca3a2c; sessionid=c5f46214aa10bb62741ceb676dca3a2c; sessionid_ss=c5f46214aa10bb62741ceb676dca3a2c; sid_ucp_v1=1.0.0-KDk2MmNkNWRjMGQyMzJlMzhlOTgzOWZmMmJhZTQxMjY2NmZlYmQ0MTMKHwiFiOPG1e2W42UQrt_argYYswsgDDCWt5muBjgIQBIQAxoGbWFsaXZhIiBjNWY0NjIxNGFhMTBiYjYyNzQxY2ViNjc2ZGNhM2EyYw; ssid_ucp_v1=1.0.0-KDk2MmNkNWRjMGQyMzJlMzhlOTgzOWZmMmJhZTQxMjY2NmZlYmQ0MTMKHwiFiOPG1e2W42UQrt_argYYswsgDDCWt5muBjgIQBIQAxoGbWFsaXZhIiBjNWY0NjIxNGFhMTBiYjYyNzQxY2ViNjc2ZGNhM2EyYw; store-idc=maliva; store-country-code=id; store-country-code-src=uid; tt-target-idc=alisg; tt-target-idc-sign=aui1AfKahGuxU6hIEUd9cLGBWTouwEmggaxQOZFj3m0tpnYR8Ewgn4OUJRVGWVWc0c8oAy6jmHjkkTMs5nY7-pEyLHx4cCe7SGQrPmUAb8pQvmjzi0XhPPOBtHEQsk8-WfZ-3m6g2_oQtdL4NkIzDaqIoopiX034PVG03hmF7oEEZorpp4CH6rmUTsnxmTTckd5Fwz3vEMOyIai3YTMl4b8810MqEomcwZ7KVMDxT7rPq166hmsylfZMaMj5aKWM5rH2fSDA8qk5NZM-pN9-FY9uSbBNEMsFXQvwIZuH8o_BUqihyYXIhqqeme9E3gQGQXLUoDJH2RLhVHn4E8Od6DD-og-aYnXtWmv4ifADOD9W0bv_dl2AfUgpbRwSXyh2wyYTg-MDovRZBBXk4UnkKPjEv3_O5N69q5OukLSMKW2bOy8WPSAizNtGS5LNfBizCEOjlUhdVypOHPu9P4A3qRSALtOlmzRyRSCEiwjH5SO7idTTfBXPtye6tUiITVga; tt_chain_token=kXwjB4G/URdmZT/58Nwr5Q==; tt_csrf_token=bXnBdKyR-MhqxKCsw9x70MTe4u8zP8jQAla4; csrf_session_id=dce5af2fc116d6a23fdeadb8db71231b; ak_bmsc=E27CFBEA38E580FE5F8C087240052FC9~000000000000000000000000000000~YAAQZlA7F+pASD2OAQAA117BVRePcHVpzqgLv3bU3lGsotYe5NN+QGdQ3sxbv67a8eFtuOHIpYXd1OMOIttSnp7Ar+I+PqJhhJ2M8XIWB1yBTDogm1qs7oXkCRvkkIAc8C5D6OGT+eDqbOUcopm1fn9u65AYYNvA325NNsLx7IweY6Dxyu+yB9os77CVYzKzQ5fK4hwvzQblwrfyYl0U4+yjwlr5d2g1iYjuTkVJDUVrSVEEOvBqDCEIkiDYp708DpE+4Cdykm11e9mO2+jU3+K2VIw65YZrdnCEBhq46RV2B2c3XQiJ5ToY9OBqNn5h+c1/X+e8VA99033gbcAwmNj1x/pk4/8o2bezkOTeNVkcRninMDbEES/vCiOx+AlD/ymrNog83qz141k=; bm_sv=4DE140CE6E16AFEFFF89E821EB97B63D~YAAQd1A7FwsI1lSOAQAAUJLRVRdpNs5uZ/3RnFr06Pxc7c/sLun2kzp1VSFLHB0QEonLqUFGcMfxRWKAAju0B+3qmVn08iMGpo/1rrI22VE8TPrK7cARGuCl0bp50otFnQya16KsAl/kmHdGizilQPvSfj9LgPrMCbX69v31QxB/vpDwZLf1UCEqEkCoFZZOeD0EPI8qA00fiG7aQsmiKH5HKaVWSb+R9NlwAkgJAqu4JxS7/VqUI0AwsDVXvoMo~1", "sasa")
	followingLive, _, err := client.CheckFollowingLive()
	assert.Empty(t, err)
	assert.NotEmpty(t, followingLive)
	fmt.Println(followingLive)
}

func TestWebcast(t *testing.T) {
	t.Run("check valid webcast", func(t *testing.T) {
		client := New("tt_chain_token=poYTFXZUlIloaorAtnr2uA==; tiktok_webapp_theme=light; passport_csrf_token=3b80fad9d1ac9b7a256b6f38f47ee9a1; passport_csrf_token_default=3b80fad9d1ac9b7a256b6f38f47ee9a1; store-country-code-src=uid; last_login_method=google; multi_sids=7333649568419595269%3Aa2cccce604d93e4cc5a1ea06dd2c4db7; cmpl_token=AgQQAPOgF-RO0rX4tcrQ6h08_5oRUYBMv4ArYNC5Ow; passport_auth_status=3ae7d6678b1a35941db6c45cd7be9229%2Ca051733e025c82b02d50528a6e9c729a; passport_auth_status_ss=3ae7d6678b1a35941db6c45cd7be9229%2Ca051733e025c82b02d50528a6e9c729a; sid_guard=a2cccce604d93e4cc5a1ea06dd2c4db7%7C1711008959%7C15552000%7CTue%2C+17-Sep-2024+08%3A15%3A59+GMT; uid_tt=5df38b814447e193f2ef7b5ab61e86bddf8b1d9b823d94c171b6ecb748642e7d; uid_tt_ss=5df38b814447e193f2ef7b5ab61e86bddf8b1d9b823d94c171b6ecb748642e7d; sid_tt=a2cccce604d93e4cc5a1ea06dd2c4db7; sessionid=a2cccce604d93e4cc5a1ea06dd2c4db7; sessionid_ss=a2cccce604d93e4cc5a1ea06dd2c4db7; sid_ucp_v1=1.0.0-KGQxYjg2YTc2NDk4ODM3MTA2N2MwMmY0OGNmYmE0YTJiNGVjMDkzNjQKHwiFiOPG1e2W42UQv9nvrwYYswsgDDCWt5muBjgIQBIQAxoGbWFsaXZhIiBhMmNjY2NlNjA0ZDkzZTRjYzVhMWVhMDZkZDJjNGRiNw; ssid_ucp_v1=1.0.0-KGQxYjg2YTc2NDk4ODM3MTA2N2MwMmY0OGNmYmE0YTJiNGVjMDkzNjQKHwiFiOPG1e2W42UQv9nvrwYYswsgDDCWt5muBjgIQBIQAxoGbWFsaXZhIiBhMmNjY2NlNjA0ZDkzZTRjYzVhMWVhMDZkZDJjNGRiNw; store-idc=maliva; store-country-code=id; tt-target-idc=alisg; tt-target-idc-sign=FKoNeyzukYOvm5JRe2gbIFN63ANyllSjUTAFfVdQDuZKHvMpnsJ4YCG-t7pa4S0i8Nq8Jc2xyyKw7-tvRzKtwzKYacHtVvNiMZtELEglRe9QbSekxuC1xWagFlgCwHrvVRF5pKn3QuuTPSl3MtRf49kwRwG2IdqC3yYecWMUmxlnjs9sMy5OXEdxQrhm0rPIpFl5jIFJN5EJyWZM4ao-0pMM7NuRaHDcF3OffLVZ9yUwIUDgRtXsKNPVztY8BxCO-VUlRil3jvwtTOzfunohcIzvjC5HRu-HFmVWZ9AnstGTXZn_HVauG3q6eISVMh90Cq4jwxaKI0MatmCKTUy4g4xLdU6je3L-H9-h2qOt-qxW2IF5ml1w60AL0tOBS8Rmy5tZIaR7gLQ43u97T6tVPLGSevB2OxJwLgBqjhVaBIh5KyolRHmBMkJEUckaLTJ5XrUXqgpK0y2pZhbt8C3qih3B3gkKLgAl3gd2NwVglHmhq9F13VtWYqUh3B-ZaWR2; living_user_id=369308913825; perf_feed_cache={%22expireTimestamp%22:1711346400000%2C%22itemIds%22:[%227340766826034433286%22%2C%227329467490315128070%22]}; tt_csrf_token=H5oDiiid-Ut2fm5bkzK2vzSIm3gOgr8bP1uI; ak_bmsc=D405A4E4DA20BDB0DAAB5D116B8ABC59~000000000000000000000000000000~YAAQXunOFw0a1UiOAQAAGHquahePN9qY20Q6bj757c1tjBSuiArWFsQcnZzguD493X3fBwkM2nJF3fCiPXtxHbZK4OvhEQqSh1GIKaS9KvTcsO1nPmxj6RmJksMB4NEm/EKO2AVwHZ0Tes8w8bs+gFq7tKR20SI2SpocBp1GikoCSFXXCKAE8MdQs9zliilOAjPSIsf0HOozGWM7S6THLGTlxxDhQIOJaE1KTGEYDNu8xrHOX4QQ+SRQf/YOAKdWOB8Aytb4fuH/v/8cx/koXuSyTy4ZWeNaskzPjSfuumIJVV8GnUZHPYRchYPgDV0wGj3sOzADGBNK5UFF8SLMmsPaY8HQ0lAk6eS3oANTnWqmyOEKBAA9hEL3AX9+qSjEfEJNzcBlwokIhSc=; csrfToken=lOalwbDO-Hf71Dzg7JBsSpvfj2pXUWX-fXkI; msToken=kY0PlzUjbDELnKDUh_rZeyz7cTgRy0rSr6hZTvySytSMmUztOpiK9GVcNO8LfYB6ldEA5N4aqDZX3jzZWKC6YoRyL5MuDmC1BytUFUqTmuC6EgniIw-Wvi1gnXKiUBzcyAUtcx0=; bm_sv=AAAE2F33F52EB9CA52E7B73686F15F6C~YAAQplA7F9KF8GaOAQAAXAa/ahe0PKbAYcyyx2O2+z7NbiR2DnkeAmYHbwAnelasY+S3tlEyA+U6aCYjKZoy/CPU1uYtQg14ZIC0PK7gB5hFcqFBmI9Io826xTWuhv8sKPaD4v48UV+1cpLEQF7P0A29atWGNv7mR7OPO8f35ZsFiri2HciKtxxzXdLzQvz2CQQuFegkkFz/Kbeg1GufIyUqLWVLvR+STUuuvjcedLm30KcPYrz3nkiCTs+FFwgV~1; msToken=qJLw0qpDX7xgRisVZ52lcs0ZfpkVlMHY9YnROed4mWCIO8-g7--xpMWbxb2ZLO0aI3HWBjMeqA29IjBcTywIJJ1Ppx4b9AZcDAHds_a-aZlxpzS0qdCdwB_LoZ2kN2W-qtXKjz8=; passport_fe_beating_status=true; ttwid=1%7CF0A-vA8HC2tATUUG9-J_PGUnkF96vEhhhV_YGBUxMBc%7C1711187890%7C2324d29ec43cc5d1f15c197153ac79f74c821e1fa098f29c6f83f48c38ff51c2; odin_tt=8611bd003668d33fb615c3117ef048c031dc34c8d266e1d1168fa50bd71484fccc8be35f80c8c2561370bf6247f288c0df5acbf108a33fb9ab2698800b8e53f2330d0075718f22614961764ea57f47cf", "32142132132132")
		room, _, err := client.GetWebcastPreloadRoom(context.TODO(), "6753936573073916930")
		assert.Empty(t, err)
		assert.Equal(t, "", room.Extra.Reason)
		fmt.Println(room)
	})

	// t.Run("check invalid webcast", func(t *testing.T) {
	// 	client := New("", "32132132144")
	// 	room, _, err := client.GetWebcastPreloadRoom(context.TODO(), "7149635949130679323")
	// 	assert.Empty(t, err)
	// 	assert.Equal(t, ReasonNoWebcast, room.Extra.Reason)
	// })
}

func TestEnterWebcast(t *testing.T) {
	t.Run("check valid webcast", func(t *testing.T) {
		client := New(`msToken=YfZPtisBKpR6z1fScA0_TN-JaD4g79VeTf4t6XF62y_jyvlPYiGjS9LN4EFh9c__bCFQ-n38dvmTD4oZdC1ydOmn3xoX51LUlV0Lasbjuj_VRQMpbC96`, "7354510690037597712")
		room, _, err := client.WebcastEnterRoom(context.TODO(), "7354462261041433349")
		assert.Empty(t, err)
		assert.Equal(t, "", room.Extra.Reason)
	})

}
